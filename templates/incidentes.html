<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.css') }}">
  <script src="{{ url_for('static', filename='jquery.js') }}"></script>
  <title>Alertas Ruta 38</title>


  <script>

    var titulos = ['tipo', 'tramo', 'comentario', 'fecha_creacion', 'estado']

    function buscar() {

      var tramo = document.getElementById("tramo").value;
      var tipo = document.getElementById("tipo").value;
      var desde = document.getElementById("desde").value;
      var hasta = document.getElementById("hasta").value;
      var sinVisualizar = document.getElementById("sinVisualizar").checked;
      var sinAlertar = document.getElementById("sinAlertar").checked;

      if (hasta != "") {
        if (desde > hasta) {
          alert("La fecha desde debe ser menor que la fecha hasta");
          return
        }
      }

      req = $.ajax({
        url: '/buscadorIncidentes',
        type: 'POST',
        data: { 'desde': desde, 'hasta': hasta, 'tramo': tramo, 'tipo': tipo, 'sinVisualizar': sinVisualizar, 'sinAlertar': sinAlertar }
      });

      req.done(function (data) {
        if (data.result == "error") {
          alert(data.error);
          return
        }
        else {

          datos = data.incidentes
          datoss = JSON.parse(datos)

          $("#incidentesDatos tr").remove();

          for (var i = 0; i < datoss.length; i++) {

            var row$ = $('<tr/>');
            for (var colIndex = 0; colIndex < 5; colIndex++) {
              var cellValue = datoss[i][titulos[colIndex]];

              /* if(titulos[colIndex]=='fecha_inicio'){
                  cellValue = datoss[i]['fecha_inicio']['$date'];
                }*/

              if (cellValue == null) cellValue = "";
              if (cellValue == 'NoVisualizado') {
                cellValue = 'No Visualizado';
              }

              row$.append($('<td/>').html(cellValue));
            }
            const idIncidente = datoss[i]['_id']['$oid']
            const tdDetalle = document.createElement("td");
            const buttonDetalle = document.createElement("button");
            buttonDetalle.type = 'button';
            buttonDetalle.className = 'btn btn-info';
            buttonDetalle.innerText = 'ver';

            buttonDetalle.onclick = function () {

              window.location.href = "/detalleIncidente?id=" + idIncidente + "";


            };

            tdDetalle.appendChild(buttonDetalle);

            row$.append(tdDetalle)

            $('#incidentesTabla').append(row$);

          }

        }
      });


    }



  </script>

</head>

<body>

  <div class="row" style="background-color: rgb(123, 138, 139); padding-left: 25px;">
    <div class="col-1"><img src="{{ url_for('static', filename='logo.png') }}" alt=""
        style="width: 50px; margin-left: 10px; padding-top: 10px;"></div>
    <div style="padding-top: 10px; color: white;">
      <h2>Gestión de Riesgos ruta nacional 38</h2>
    </div>
  </div>


  <br>

  <div class="container">
    <div>
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link" href="/novedades">Novedades</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/ultimas24hs">Alertas en las últimas 24 hs</a>
        </li>
        <li class="nav-item ">
          <a class="nav-link " href="/informes">Informes</a>
        </li>
        <li class="nav-item ">
          <a class="nav-link" href="/buscador">Buscador</a>
        </li>
        <li class="nav-item ">
          <a class="nav-link active" href="#">Incidentes</a>
        </li>
      </ul>
    </div>
    <br>
    <br>


    <div class="form-group row">
      <div class="row col-10">
        <div class="row col-6">
          <div class="col-3">
            <label class="col-form-label" for="inputDefault">Tipo: </label>
          </div>
          <div class="col-9">
            <select class="custom-select" id="tipo">
              <option selected value="">Todos los tipos de Riesgo</option>
              <option value="niebla">Niebla</option>
              <option value="lluvia">Lluvia</option>
              <option value="humo">Humo</option>
              <option value="viento">Viento</option>
              <option value="animales">Animales</option>
              <option value="vehiculos">Vehículos lentos</option>
              <option value="otros">Otros</option>
            </select>
          </div>
        </div>
        <div class="row col-6">
          <div class="col-3">
            <label class="col-form-label" for="inputDefault">Tramo: </label>
          </div>
          <div class="col-9">
            <select class="custom-select" id="tramo">
              <option selected value="">Todos los tramos</option>
              <option value="Rumi Punco - Pueblo Viejo">Rumi Punco - Pueblo Viejo</option>
              <option value="Pueblo Viejo - Rio el Sueño">Pueblo Viejo - Rio el Sueño</option>
              <option value="Rio el Sueño - Huasa Pampa">Rio el Sueño - Huasa Pampa</option>
              <option value="Huasa Pampa - Rio Marapa">Huasa Pampa - Rio Marapa</option>
              <option value="Rio Marapa - Villa Belgrano">Rio Marapa - Villa Belgrano</option>
              <option value="Villa Belgrano - Aguilares">Villa Belgrano - Aguilares</option>
              <option value="Aguilares - Concepcion">Aguilares - Concepcion</option>
              <option value="Concepcion - Rio Seco">Concepcion - Rio Seco</option>
              <option value="Rio Seco - Monteros">Rio Seco - Monteros</option>
              <option value="Monteros - Rio Caspichango">Monteros - Rio Caspichango</option>
              <option value="Rio Caspichango - Interseccion ruta 322">Rio Caspichango - Interseccion ruta 322
              </option>
              <option value="Interseccion ruta 322 - Interseccion ruta 321">Interseccion ruta 322 - Interseccion
                ruta 321</option>
              <option value="Interseccion ruta 321 - S M de Tuc">Interseccion ruta 321 - S M de Tuc</option>

            </select>
          </div>
        </div>

        <div class="row col-6" style="margin-top: 15px; ">
          <div class="col-3">
            <label class="col-form-label" for="inputDefault">Desde: </label>
          </div>
          <div class="col-9">
            <input type="datetime-local" class="form-control" placeholder="Default input" id="desde">
          </div>
        </div>
        <div class="row col-6" style="margin-top: 15px;">
          <div class="col-3">
            <label class="col-form-label" for="inputDefault">Hasta: </label>
          </div>
          <div class="col-9">
            <input type="datetime-local" class="form-control" placeholder="Default input" id="hasta">
          </div>
        </div>
        <div class="row col-6" style="margin-top: 15px;">
          <div class="col-4">
            <label class="col-form-label" for="inputDefault">Sin visualizar: </label>
          </div>
          <div class="col-2">
            <input type="checkbox" style="width: 30px; margin-top: 12px; " class="" id="sinVisualizar">
          </div>
        </div>
        <div class="row col-6" style="margin-top: 15px;">
          <div class="col-3">
            <label class="col-form-label" for="inputDefault">Sin alertar: </label>
          </div>
          <div class="col-2" style="text-align: right;">
            <input type="checkbox" style="width: 30px; margin-top: 12px; margin-left: -10px; " class="" id="sinAlertar">
          </div>
        </div>


      </div>
      <div class="col-1">
        <div class="col-1">
          <button type="button" class="btn btn-primary" style="margin-left:-60px" onclick="buscar()">Buscar</button>
        </div>
      </div>
      <div class="col-1">
        <div class="col-1">
          <!-- <button type="button" class="btn btn-primary"  style="margin-top: 35px; margin-left: -15px;"
                  onclick="generar()">+</button> -->
          <a class="btn btn-danger" href="/generarIncidente">+</a>
        </div>
      </div>
    </div>
    <table class="table table-striped" id="incidentesTabla">
      <thead>
        <tr class="table-primary">

          <td>Tipo</td>
          <td>Tramo</td>
          <td>Comentario</td>
          <td>Fecha y Hora</td>
          <td>Estado</td>
          <td>Detalle</td>
        </tr>
      </thead>
      <tbody id="incidentesDatos">

      </tbody>
    </table>

  </div>

</body>

</html>